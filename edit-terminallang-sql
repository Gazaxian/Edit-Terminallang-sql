#!/bin/bash

# Caminho do banco de dados
db="$HOME/Documentos/terminallang-sqlite/frases.db"

# Cores
BRANCO="\e[97m"
AZUL="\e[34m"
VERDE="\e[32m"
VERMELHO="\e[31m"
AMARELO="\e[33m"
RESET="\e[0m"

# FunÃ§Ã£o para listar frases com paginaÃ§Ã£o
listar_frases() {
    total=$(sqlite3 "$db" "SELECT COUNT(*) FROM frases;")
    limite=5
    pagina=0
    total_paginas=$(( (total + limite - 1) / limite ))
    
    while true; do
        clear
        inicio=$((pagina * limite))
        
        frases=$(sqlite3 "$db" "SELECT id, frase FROM frases LIMIT $limite OFFSET $inicio;")
        echo -e "ðŸ“– ${BRANCO}Frases salvas:${RESET}\n"
        
        IFS="|"
        while read -r id frase; do
            echo -e "${BRANCO}[$id]${RESET} ${AZUL}$frase${RESET}"
            echo -e "----------------------------------"
        done <<< "$frases"
        
        echo -e "${AZUL}PÃ¡gina $((pagina + 1))/$total_paginas${RESET}"
        echo -e "[N] PrÃ³xima pÃ¡gina | [P] PÃ¡gina anterior | [Q] Sair"
        read -n 1 -s resposta
        case "$resposta" in
            n|N) [[ $pagina -lt $((total_paginas - 1)) ]] && ((pagina++)) ;;
            p|P) [[ $pagina -gt 0 ]] && ((pagina--)) ;;
            q|Q) clear; break ;;
        esac
    done
}

# FunÃ§Ã£o para adicionar uma nova frase
adicionar_frase() {
    echo -e "${AZUL}Digite a nova frase:${RESET}"
    read frase
    sqlite3 "$db" "INSERT INTO frases (frase) VALUES ('$frase');"
    echo -e "${VERDE}âœ… Frase adicionada com sucesso!${RESET}"
}

# FunÃ§Ã£o para editar uma frase existente
editar_frase() {
    listar_frases
    echo -e "${AZUL}Digite o ID da frase que deseja editar:${RESET}"
    read id
    echo -e "${AZUL}Digite a nova versÃ£o da frase:${RESET}"
    read nova_frase
    sqlite3 "$db" "UPDATE frases SET frase = '$nova_frase' WHERE id = $id;"
    echo -e "${VERDE}âœ… Frase editada com sucesso!${RESET}"
}

# FunÃ§Ã£o para excluir uma frase
excluir_frase() {
    listar_frases
    echo -e "${AZUL}Digite o ID da frase que deseja excluir:${RESET}"
    read id
    sqlite3 "$db" "DELETE FROM frases WHERE id = $id;"
    echo -e "${VERMELHO}âŒ Frase excluÃ­da com sucesso!${RESET}"
}

# Menu principal
while true; do
    echo -e "\nðŸ“š ${BRANCO}Editor do Terminallang-SQLite${RESET}\n"
    echo -e "${AZUL}1) âœï¸ Adicionar frase${RESET}"
    echo -e "${VERDE}2) ðŸ“– Listar frases${RESET}"
    echo -e "${AMARELO}3) âœï¸ Editar frase${RESET}"
    echo -e "${VERMELHO}4) âŒ Excluir frase${RESET}"
    echo -e "${BRANCO}5) ðŸšª Sair${RESET}"
    read -p "Escolha uma opÃ§Ã£o: " opcao
    
    case $opcao in
        1) adicionar_frase ;;
        2) listar_frases ;;
        3) editar_frase ;;
        4) excluir_frase ;;
        5) echo -e "${VERMELHO}Saindo...${RESET}"; exit 0 ;;
        *) echo -e "${VERMELHO}OpÃ§Ã£o invÃ¡lida!${RESET}" ;;
    esac

done
